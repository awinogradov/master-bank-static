function scrollTop(){Modernizr.mq("(max-width: 480px)")&&$("html, body").animate({scrollTop:"0px"},300)}function block_validations(t){t.find(".error").removeClass("error").unbind("focus"),window.ERRORS={};var r=0;return t.find(".required").required(),t.find(".minlength").minlength(),t.find(".maxlength").maxlength(),t.find(".numbers").numbers(),t.find("#acquiring_invoice, #acquiring_amount").no_zero(),t.find(".characters").characters(),t.find(".month").month($('input[name="acquiring[expires_year]"]')),t.find(".year").year(),t.find(".mastercard").mastercard(),Object.keys(ERRORS).length>0?($.each(ERRORS,function(n){var e=$("#"+n);e.hasClass("combined-field")?(e.addClass("error"),$(".combined").tooltip({placement:"top",trigger:"manual",title:function(){return $(this).data("error")}}),$(".combined-field.error").on("click",function(){t.find(".tooltip").not($(this).parent()).hide(),$(this).parent().tooltip("show")}),r+=1):(e.addClass("error"),$(".error").tooltip({placement:"top",trigger:"manual",title:function(){return $(this).data("error")}}),$(".error").on("focus",function(){t.find(".tooltip").not(this).hide(),$(this).tooltip("show")}))}),r>0?t.find(".combined").first().tooltip("show").find(".combined-field").first().click():($("#"+Object.keys(ERRORS)[0]).tooltip("show").focus(),PAYFORM.tooltip=!0),!1):!0}function replace_characters(){for(var t=$(this),r=t.val().length-1;r>=0;r--)t.val(t.val().replace(/[^0-9]+/g,""))}function replace_numbers(){for(var t=$(this),r=t.val().length-1;r>=0;r--)t.val(t.val().replace(/[\dа-яА-Я-!$%^&*()_+|~=`{}\[\]:";'<>?,.\/]/g,""))}$(document).ready(function(){var t={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown"},searchString:function(t){for(var r=0;r<t.length;r++){var n=t[r].string;if(this.versionSearchString=t[r].subString,-1!=n.indexOf(t[r].subString))return t[r].identity}},searchVersion:function(t){var r=t.indexOf(this.versionSearchString);if(-1!=r)return parseFloat(t.substring(r+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]};t.init(),window.PAYFORM={},PAYFORM.tooltip=!1,PAYFORM.submit=!1,PAYFORM.step=1;var r=new Date,n=r.getFullYear().toString();$("#acquiring_exp_year").attr("placeholder",n.substr(n.length-2)),$("#next-slide").on("click",function(){return PAYFORM.step_1_validations()?($(".step-number-1").find(".tooltip").hide(),$("#form-steps").animate({left:"-100%"},300),$(".step-number-1").animate({opacity:0},200),$(".step-number-2").animate({opacity:1},200),PAYFORM.step=2,scrollTop()):scrollTop(),!1}),$("#back-slide").on("click",function(){return $("#form-steps").animate({left:"0"},300),$(".step-number-1").animate({opacity:1},200),$(".step-number-2").animate({opacity:0},200),scrollTop(),PAYFORM.step=1,!1}),$("#informer").popover({trigger:"click",html:!0,content:function(){var t=Modernizr.highres;return img=t?"<img src='resources/images/cvv_tooltip@2.jpg' alt='cvv_tooltip'/>":"<img src='resources/images/cvv_tooltip.png' alt='cvv_tooltip'/>","<div class='cvv-info'>Three last digits <br/> on the back side of the card</div>"+img}}),$("#informer").on("click",function(){PAYFORM.informer=!0,$(".popover").css("left",function(t){return t-234})}),$("#informer").outside("click",function(){PAYFORM.informer=!1,$("#informer").popover("hide")}),$(".numbers").keyup(replace_characters).blur(replace_characters),$(".characters").keyup(replace_numbers).blur(replace_numbers),$(".autotab").keyup(function(){var t=$(this),r=t.data("tablength"),n=t.data("selector"),e=t.attr("id").split("-")[1],i=parseInt(e)+1;t.val().length==r&&$("#"+n+"-"+i).focus()}),PAYFORM.step_1_validations=function(){var t=$(".step-number-1");return block_validations(t)},PAYFORM.step_2_validations=function(){var t=$(".step-number-2");return block_validations(t)},$("#btn_submit").click(function(){var r=t.browser.toString();return"Explorer"!=r||confirm("Are you sure you want to submit this payment? Amount:"+document.getElementsByName("acquiring[amount]")[0].value+" ₤. Invoice:"+document.getElementsByName("acquiring[invoice]")[0].value)?void 0:!1}),$("body").on("submit","#acquiring_form",function(){var r={};if(r.card_number=$("#cardblock-1").val()+$("#cardblock-2").val()+$("#cardblock-3").val()+$("#cardblock-4").val(),$('input[name="acquiring[card_num]"]').val(r.card_number),r.expires_on=$('input[name="acquiring[expires_month]"]').val()+"/"+$('input[name="acquiring[expires_year]"]').val(),r.invoice_number=$('input[name="acquiring[invoice]"]').val(),r.peny=""==$('input[name="simulate[peny]"]').val()?0:$('input[name="simulate[peny]"]').val(),r.amount=$('input[name="acquiring[amount]"]').val()+","+r.peny,r.cvv=$('input[name="acquiring[cvc2]"]').val(),r.holders_name=$('input[name="acquiring[holder]"]').val(),"Explorer"!=t.browser)try{if(PAYFORM.step_1_validations()&&PAYFORM.step_2_validations()){var n=$("#payment-confirmation");$(".step-number-2").find(".tooltip").hide(),$("#confirm-card-number").text(r.card_number),$("#confirm-expires-on").text(r.expires_on),$("#confirm-invoice-number").text(r.invoice_number),$("#confirm-amount").text(r.amount+" ₤"),$("#confirm-cvv").text(r.cvv),$("#confirm-holders-name").text(r.holders_name),$(".page").addClass("blur"),n.modal("show"),n.on("click","#cancel-payment",function(){$(".page").removeClass("blur"),n.modal("hide")}),n.on("click","#confirm-payment",function(){n.modal("hide"),$("#acquiring_form").hide(),$(".page").removeClass("blur"),$(".response").show(),PAYFORM.submit=!0,$("#acquiring_form").submit()})}else scrollTop()}catch(e){console.log(e.name+" : "+e.message)}finally{return PAYFORM.submit}})}),function(t){t.fn.outside=function(r,n){return this.each(function(){var e=(t(this),this);t(document).bind(r,function i(a){a.target===e||t.contains(e,a.target)||(n.apply(e,[a]),e.parentNode||t(document.body).unbind(r,i))})})}}(jQuery),function(t){t.fn.required=function(){return this.each(function(){var r=t(this);if(0==r.val().length){var n="This field is required";ERRORS[r.attr("id")]=n,r.data("error",n)}})}}(jQuery),function(t){t.fn.minlength=function(){return this.each(function(){var r=t(this),n=4;if(void 0!=r.data("minlength")&&(n=r.data("minlength")),r.val().length<parseInt(n)){var e="Minlength is "+n;ERRORS[r.attr("id")]=e,r.data("error",e)}})}}(jQuery),function(t){t.fn.maxlength=function(){return this.each(function(){var r=t(this),n=4;if(void 0!=r.data("maxlength")&&(n=r.data("maxlength")),r.val().length>parseInt(n)){var e="Maxlength is "+n;ERRORS[r.attr("id")]=e,r.data("error",e)}})}}(jQuery),function(t){t.fn.year=function(){return this.each(function(){var r=t(this),n=new Date,e=n.getFullYear().toString();if(parseInt(r.val())<parseInt(e.substr(e.length-2))){var i="Incorrect year. Must be >= "+e.substr(e.length-2);ERRORS[r.attr("id")]=i,r.data("error",i)}})}}(jQuery),function(t){t.fn.month=function(r){return this.each(function(){var n=t(this),e=new Date,i=e.getMonth()+1,a=e.getFullYear().toString();if(parseInt(n.val())>12||parseInt(n.val())<1){var o="Incorrect month. Must be <= 12 and >= 1";ERRORS[n.attr("id")]=o,n.data("error",o)}else if(parseInt(r.val())==parseInt(a.substr(a.length-2))&&parseInt(n.val())<parseInt(i)){var o="incorrect month. Must be > "+i;ERRORS[n.attr("id")]=o,n.data("error",o)}})}}(jQuery),function(t){t.fn.numbers=function(){return this.each(function(){var r=t(this);if(null!=t(this).val().match(/[^0-9]+/g)){var n="Numbers only";ERRORS[r.attr("id")]=n,r.data("error",n)}})}}(jQuery),function(t){t.fn.no_zero=function(){return this.each(function(){var r=t(this);if(0==parseInt(t(this).val().charAt(0))){var n="Numbers must be > 0";ERRORS[r.attr("id")]=n,r.data("error",n)}})}}(jQuery),function(t){t.fn.characters=function(){return this.each(function(){var r=t(this);if(null!=t(this).val().match(/[^a-z] /i)){var n="Latin characters only";ERRORS[r.attr("id")]=n,r.data("error",n)}})}}(jQuery),function(t){t.fn.mastercard=function(){return this.each(function(){var r=t(this);if(5!=t(this).val().charAt(0)){var n="Master Card only. Begin from 5";ERRORS[r.attr("id")]=n,r.data("error",n),r.parent(".combined").data("error",n)}})}}(jQuery),Modernizr.addTest("highres",function(){for(var t="2.99/2",r="1.499",n=["only screen and (-o-min-device-pixel-ratio:"+t+")","only screen and (min--moz-device-pixel-ratio:"+r+")","only screen and (-webkit-min-device-pixel-ratio:"+r+")","only screen and (min-device-pixel-ratio:"+r+")"],e=!1,i=n.length-1;i>=0;i--)if(e=Modernizr.mq(n[i]))return e;return e}),$(window).load(function(){var t=Modernizr.highres;if(t){var r=$("img");r.each(function(){var t=$(this);void 0!=t.data("retina")&&(t.attr("src",t.attr("src").substr(0,t.attr("src").length-4)+t.data("retina")+t.attr("src").substr(t.attr("src").length-4)),t.hasClass("retina-support")&&t.parents(".response").hasClass("hide")&&t.attr("width","50%").css({right:"-50%",position:"relative"}))})}});